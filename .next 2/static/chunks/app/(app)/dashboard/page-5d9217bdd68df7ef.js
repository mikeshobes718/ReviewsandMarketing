(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[536],{7328:(e,s,a)=>{Promise.resolve().then(a.bind(a,9624))},9624:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>d});var t=a(5155),n=a(2115);a(6995),a(1124);var l=a(877);let r=["qr","whatsapp","sms","email","link"],i={qr:"#2563EB",whatsapp:"#22C55E",sms:"#06B6D4",email:"#F59E0B",link:"#64748B"};function o(){let[e,s]=(0,n.useState)(null);if((0,n.useEffect)(()=>{let e=localStorage.getItem("idToken");fetch("/api/analytics/links/timeseries?days=30",{cache:"no-store",headers:e?{Authorization:"Bearer ".concat(e)}:{}}).then(e=>e.ok?e.json():Promise.reject(Error(String(e.status)))).then(s).catch(()=>s(null))},[]),!e)return null;let a=r.map(s=>({label:s.toUpperCase(),data:e.labels.map((a,t)=>{var n;return{x:a,y:(null==(n=e.series[s])?void 0:n[t])||0}}),borderColor:i[s],backgroundColor:i[s],tension:.25,borderWidth:2,pointRadius:0}));return(0,t.jsxs)("div",{className:"border rounded-md p-4 space-y-3",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Share performance (last 30 days)"}),(0,t.jsx)(l.N1,{data:{datasets:a},options:{maintainAspectRatio:!1,responsive:!0,scales:{x:{type:"time",time:{unit:"day"}},y:{beginAtZero:!0,ticks:{precision:0}}},plugins:{legend:{position:"bottom"}}},height:260})]})}function d(){let[e,s]=(0,n.useState)(null),[a,l]=(0,n.useState)(!1),[r,i]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=localStorage.getItem("idToken");e&&(l(!0),fetch("/api/businesses/me",{headers:{Authorization:"Bearer ".concat(e)}}).then(async e=>{if(!e.ok)throw Error(await e.text());return e.json()}).then(e=>{var a;return s(null!=(a=e.business)?a:null)}).catch(e=>{var s;return i(null!=(s=null==e?void 0:e.message)?s:"Failed to load business")}).finally(()=>l(!1)))},[]);let d=(0,n.useMemo)(()=>(null==e?void 0:e.google_maps_write_review_uri)||(null==e?void 0:e.review_link)||void 0,[e]),c=(0,n.useMemo)(()=>d?"/api/qr?data=".concat(encodeURIComponent(d),"&format=png&scale=8"):null,[d]);return(0,t.jsxs)("main",{className:"p-8 space-y-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Dashboard"}),a&&(0,t.jsx)("div",{className:"text-gray-600",children:"Loadingâ€¦"}),r&&(0,t.jsx)("div",{className:"text-red-600 text-sm",children:r}),!a&&!e&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-gray-700",children:"No business connected."}),(0,t.jsx)("a",{className:"underline text-blue-600",href:"/onboarding/business",children:"Connect your business"})]}),e&&(0,t.jsxs)("div",{className:"border rounded-md p-4 space-y-3",children:[(0,t.jsx)("div",{className:"text-lg font-semibold",children:e.name}),"number"==typeof e.google_rating&&(0,t.jsxs)("div",{className:"text-gray-700",children:["Rating ",e.google_rating]}),d&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{className:"w-full border rounded px-2 py-1",readOnly:!0,value:d}),(0,t.jsx)("button",{className:"px-3 py-1 rounded bg-blue-600 text-white",onClick:()=>navigator.clipboard.writeText(d),children:"Copy link"}),(0,t.jsx)("a",{className:"px-3 py-1 rounded border",target:"_blank",href:d,rel:"noreferrer",children:"Test link"})]}),c&&(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("img",{src:c,alt:"QR code",className:"h-32 w-32 border rounded"}),(0,t.jsx)("a",{className:"underline text-blue-600",href:c,download:!0,children:"Download QR (PNG)"})]})]})]}),(0,t.jsx)(o,{})]})}}},e=>{e.O(0,[647,822,441,255,358],()=>e(e.s=7328)),_N_E=e.O()}]);