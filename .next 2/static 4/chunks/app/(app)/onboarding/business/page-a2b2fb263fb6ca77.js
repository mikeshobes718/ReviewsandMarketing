(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[352],{4382:(e,a,s)=>{Promise.resolve().then(s.bind(s,9909))},9909:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>r});var t=s(5155),l=s(2115);function n(){return crypto.randomUUID()}function r(){let[e,a]=(0,l.useState)(""),[s,r]=(0,l.useState)(()=>n()),[i,o]=(0,l.useState)([]),[d,c]=(0,l.useState)(!1),[u,m]=(0,l.useState)(null),[p,x]=(0,l.useState)(!1),[h,g]=(0,l.useState)(null);async function f(e){c(!0),g(null);try{let a="/api/places/details?placeId=".concat(encodeURIComponent(e),"&sessionToken=").concat(encodeURIComponent(s)),t=await fetch(a),l=await t.json();m(l),r(n()),o([])}catch(e){g(e instanceof Error?e.message:"Failed to fetch place details")}finally{c(!1)}}async function y(){if(u){x(!0),g(null);try{var e,a;let s=await fetch("/api/businesses/upsert",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u.displayName,google_place_id:u.id,google_maps_place_uri:u.googleMapsUri,google_maps_write_review_uri:u.writeAReviewUri,review_link:u.writeAReviewUri,google_rating:null!=(e=u.rating)?e:null,address:null!=(a=u.formattedAddress)?a:null})});if(!s.ok)throw Error(await s.text());window.location.href="/dashboard"}catch(e){g(e instanceof Error?e.message:"Save failed")}finally{x(!1)}}}(0,l.useEffect)(()=>{let a=new AbortController;if(!e.trim())return void o([]);c(!0);let t=setTimeout(async()=>{try{let t=await fetch("/api/places/autocomplete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:e,sessionToken:s}),signal:a.signal}),l=await t.json();o(l.items||[])}catch(e){g(e instanceof Error?e.message:"Autocomplete failed")}finally{c(!1)}},200);return()=>{a.abort(),clearTimeout(t)}},[e,s]);let v=null==u?void 0:u.writeAReviewUri,b=(0,l.useMemo)(()=>v?"/api/qr?data=".concat(encodeURIComponent(v),"&format=png&scale=8"):null,[v]),w=(0,l.useMemo)(()=>v?"/api/qr?data=".concat(encodeURIComponent(v),"&format=svg&scale=8"):null,[v]);return(0,t.jsxs)("div",{className:"max-w-3xl mx-auto p-6 space-y-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"Connect your business"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Search your business by name, then confirm the address."}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{className:"w-full border rounded-md px-4 py-2",placeholder:"Start typing your business name…",value:e,onChange:e=>a(e.target.value)}),d&&(0,t.jsx)("div",{className:"absolute right-3 top-2.5 text-sm text-gray-500",children:"Searching…"}),!!i.length&&(0,t.jsxs)("div",{className:"mt-2 border rounded-md bg-white shadow-md",children:[(0,t.jsx)("ul",{className:"max-h-72 overflow-auto",children:i.map(e=>(0,t.jsxs)("li",{className:"px-4 py-2 hover:bg-gray-50 cursor-pointer",onClick:()=>f(e.placeId),children:[(0,t.jsx)("div",{className:"font-medium",children:e.mainText}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:e.secondaryText})]},e.placeId))}),(0,t.jsx)("div",{className:"border-t px-3 py-2 text-xs text-gray-500 flex items-center gap-2",children:(0,t.jsx)("span",{children:"Powered by Google"})})]})]}),u&&(0,t.jsxs)("div",{className:"border rounded-md p-4 space-y-3",children:[(0,t.jsx)("div",{className:"text-lg font-semibold",children:u.displayName}),(0,t.jsx)("div",{className:"text-gray-700",children:u.formattedAddress}),(0,t.jsxs)("div",{className:"text-gray-700",children:[u.rating?"Rating ".concat(u.rating," \xb7 "):"",u.userRatingCount?"".concat(u.userRatingCount," reviews"):""]}),v&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{className:"w-full border rounded px-2 py-1",readOnly:!0,value:v}),(0,t.jsx)("button",{className:"px-3 py-1 rounded bg-blue-600 text-white",onClick:()=>navigator.clipboard.writeText(v),children:"Copy link"}),(0,t.jsx)("a",{className:"px-3 py-1 rounded border",target:"_blank",href:v,rel:"noreferrer",children:"Test link"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[b&&(0,t.jsx)("img",{src:b,alt:"QR code",className:"h-32 w-32 border rounded"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[b&&(0,t.jsx)("a",{className:"underline text-blue-600",href:b,download:!0,children:"Download QR (PNG)"}),w&&(0,t.jsx)("a",{className:"underline text-blue-600",href:w,download:!0,children:"Download QR (SVG)"})]})]})]}),(0,t.jsx)("div",{className:"pt-2",children:(0,t.jsx)("button",{disabled:p,className:"px-4 py-2 rounded bg-green-600 text-white disabled:opacity-50",onClick:y,children:p?"Saving…":"Save business"})})]}),h&&(0,t.jsx)("div",{className:"text-red-600 text-sm",children:h})]})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=4382)),_N_E=e.O()}]);